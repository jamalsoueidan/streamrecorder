import api from "@/app/api";
import InfiniteFollowers from "@/app/ui/infinite";
import { ScopeEnum } from "@/lib/types/strapi-autogenerated";

export default async function FollowingsPage() {
  const response = await api.follower.browseFollowers({
    scope: ScopeEnum.Discover,
    hasRecordings: true,
    populate: {
      recordings: {
        populate: {
          sources: {
            fields: ["id", "documentId", "path", "duration"],
          },
        },
      },
    },
    "pagination[page]": 1,
    "pagination[pageSize]": 10,
    sort: "username:asc",
  });

  const data = response.data?.data || [];
  const meta = response.data?.meta;

  return (
    <section>
      <div
        style={{
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center",
          marginBottom: 16,
        }}
      >
        <h2>Discover ({response.data?.meta?.pagination?.total})</h2>
      </div>

      {data.length === 0 ? (
        <p>No more accounts to discover.</p>
      ) : (
        <InfiniteFollowers
          initialData={data}
          initialPagination={meta}
          initialSort="username:asc"
        />
      )}
    </section>
  );
}
