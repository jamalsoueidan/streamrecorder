"use client";

import { unfollow } from "@/app/actions/followers";
import { FollowRequestBody } from "@/lib/types/strapi-autogenerated";
import { ActionIcon, Tooltip } from "@mantine/core";
import { notifications } from "@mantine/notifications";
import { IconCheck, IconUsersMinus } from "@tabler/icons-react";
import { useTranslations } from "next-intl";
import { useTransition } from "react";

export default function UnfollowButton({
  username,
  type,
  onSuccess,
}: FollowRequestBody & { onSuccess?: () => void }) {
  const [isPending, startTransition] = useTransition();
  const t = useTranslations("protected.common");

  const handleClick = () => {
    startTransition(async () => {
      await unfollow({ username, type });

      notifications.show({
        title: t("unfollow.successTitle"),
        message: username
          ? t("unfollow.successMessage", { username })
          : t("unfollow.successMessageGeneric"),
        color: "green",
        icon: <IconCheck size={16} />,
      });
      onSuccess?.();
    });
  };

  return (
    <Tooltip label={t("unfollow.tooltip")}>
      <ActionIcon
        size="lg"
        color="gray"
        type="button"
        onClick={handleClick}
        loading={isPending}
      >
        <IconUsersMinus />
      </ActionIcon>
    </Tooltip>
  );
}
