"use client";

import { generateAvatarUrl } from "@/app/lib/avatar-url";
import { FollowerTypeEnum, Recording } from "@/lib/types/strapi-autogenerated";
import { Anchor, Avatar, Grid, Group, Stack, Text } from "@mantine/core";
import { useFormatter, useNow, useTranslations } from "next-intl";
import Link from "next/link";
import { getProfileUrl } from "../../../components/open-social";
import { ImageVideoPreview } from "./image-video-preview";

interface Props {
  recording: Recording;
}

export default function RecordingItem({ recording }: Props) {
  const format = useFormatter();
  const now = useNow({ updateInterval: 1000 * 30 });
  const t = useTranslations("protected.common.recordings");

  return (
    <Grid gutter="xs" key={recording.documentId} w="100%">
      {recording.follower && (
        <Grid.Col span={12}>
          <ImageVideoPreview
            username={recording.follower?.username || "unknown"}
            type={recording.follower?.type || FollowerTypeEnum.Tiktok}
            recording={recording}
          />
        </Grid.Col>
      )}
      <Grid.Col span={12}>
        <Group gap="xs">
          <Anchor component={Link} href={getProfileUrl(recording.follower)}>
            <Avatar
              size={38}
              src={generateAvatarUrl(recording.follower?.avatar?.url)}
              styles={{
                image: { transform: "scale(2)", objectFit: "cover" },
              }}
            />
          </Anchor>
          <Stack gap="0">
            <Anchor
              component={Link}
              href={getProfileUrl(recording.follower)}
              size="md"
              truncate
              maw={110}
              display="inline-block"
            >
              {recording.follower?.username}
            </Anchor>
            <Text size="xs" suppressHydrationWarning>
              {t("recordedAgo", {
                time: format.relativeTime(new Date(recording.updatedAt || ""), {
                  now,
                }),
              })}
            </Text>
          </Stack>
        </Group>
      </Grid.Col>
    </Grid>
  );
}
