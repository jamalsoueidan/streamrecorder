import InfiniteFollowers from "@/app/(protected)/_components/infinite-followers";
import { getFollowers } from "@/app/actions/followers";
import { SortOptions } from "@/lib/types/filtering";
import { ScopeEnum } from "@/lib/types/strapi-autogenerated";
import { ActionIcon, Anchor, Button, Stack, Text, Title } from "@mantine/core";
import { IconUsers, IconWorldSearch } from "@tabler/icons-react";

interface PageProps {
  searchParams: Promise<{
    sort?: string;
  }>;
}

export default async function Page({ searchParams }: PageProps) {
  const { sort } = await searchParams;
  const response = await getFollowers({
    scope: ScopeEnum.Following,
    page: 1,
    sort: !sort ? SortOptions.UsernameAsc : (sort as unknown as SortOptions),
  });

  const data = response.data || [];
  const meta = response.meta;

  const fetchAction = async (options: Parameters<typeof getFollowers>[0]) => {
    "use server";
    return await getFollowers({
      ...options,
      hasRecordings: undefined,
    });
  };

  return (
    <section>
      {data.length === 0 ? (
        <Stack align="center" justify="center" py={80} gap="lg">
          <ActionIcon
            variant="transparent"
            size={120}
            radius="xl"
            color="white"
          >
            <IconUsers size={90} stroke={2} />
          </ActionIcon>
          <Stack align="center" gap={12}>
            <Title order={2} fw={600}>
              No one here yet
            </Title>
            <Text size="xl" c="dimmed" maw={450} ta="center">
              Start exploring and follow people to see them here
            </Text>
          </Stack>
          <Anchor href="/discover" underline="never">
            <Button
              size="lg"
              radius="md"
              leftSection={<IconWorldSearch size={20} />}
            >
              Discover Streamers
            </Button>
          </Anchor>
        </Stack>
      ) : (
        <InfiniteFollowers
          key={meta?.pagination?.total}
          title="Following"
          initialData={data}
          initialPagination={meta}
          initialSort={SortOptions.UsernameAsc}
          initialScope={ScopeEnum.Following}
          fetchAction={fetchAction}
        />
      )}
    </section>
  );
}
