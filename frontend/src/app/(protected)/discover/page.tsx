import InfiniteFollowers from "@/app/(protected)/_components/infinite-followers";
import { getFollowers } from "@/app/actions/followers";
import { SortOptions } from "@/lib/types/filtering";

import { ScopeEnum } from "@/lib/types/strapi-autogenerated";

interface PageProps {
  searchParams: Promise<{
    hasRecordings?: string;
    sort?: string;
  }>;
}

export default async function Page({ searchParams }: PageProps) {
  const { sort, hasRecordings } = await searchParams;

  const response = await getFollowers({
    scope: ScopeEnum.Discover,
    page: 1,
    sort: !sort ? SortOptions.createdAtDesc : (sort as unknown as SortOptions),
    hasRecordings: !hasRecordings,
  });

  const data = response.data || [];
  const meta = response.meta;

  return (
    <section>
      {data.length === 0 ? (
        <p>No more accounts to discover.</p>
      ) : (
        <InfiniteFollowers
          title="Discover"
          initialData={data}
          initialPagination={meta}
          initialSort={SortOptions.createdAtDesc}
          initialScope={ScopeEnum.Discover}
        />
      )}
    </section>
  );
}
