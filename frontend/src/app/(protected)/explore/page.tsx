import InfiniteRecordings from "@/app/(protected)/_components/infinity-recordings";
import { getRecordings } from "@/app/actions/recordings";
import { SortOptions } from "@/lib/types/filtering";
import { ScopeEnum } from "@/lib/types/strapi-autogenerated";
import { ActionIcon, Anchor, Button, Stack, Text, Title } from "@mantine/core";
import { IconVideo, IconWorldSearch } from "@tabler/icons-react";

export default async function FollowingsPage() {
  const response = await getRecordings({
    scope: ScopeEnum.Discover,
    "pagination[page]": 1,
    sort: SortOptions.createdAtDesc,
  });

  const data = response.data || [];
  const meta = response.meta;

  const fetchAction = async (options: Parameters<typeof getRecordings>[0]) => {
    "use server";
    return await getRecordings({ ...options, scope: ScopeEnum.Discover });
  };

  return (
    <section>
      {data.length === 0 ? (
        <Stack align="center" justify="center" py={80} gap="lg">
          <ActionIcon
            variant="transparent"
            size={120}
            radius="xl"
            color="white"
          >
            <IconVideo size={90} stroke={2} />
          </ActionIcon>
          <Stack align="center" gap={12}>
            <Title order={2} fw={600}>
              No recordings yet
            </Title>
            <Text size="xl" c="dimmed" maw={450} ta="center">
              Follow streamers to see their recordings here
            </Text>
          </Stack>
          <Anchor href="/discover" underline="never">
            <Button
              size="lg"
              radius="md"
              leftSection={<IconWorldSearch size={20} />}
            >
              Discover Streamers
            </Button>
          </Anchor>
        </Stack>
      ) : (
        <InfiniteRecordings
          initialData={data}
          initialPagination={meta}
          initialSort={SortOptions.createdAtDesc}
          fetchAction={fetchAction}
        />
      )}
    </section>
  );
}
